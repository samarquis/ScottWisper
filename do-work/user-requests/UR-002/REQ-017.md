---
id: REQ-017
title: Expand AuditLoggingService
status: completed
created_at: 2026-02-06T17:55:00Z
completed_at: 2026-02-07T13:00:00Z
user_request: UR-002
batch: nist-compliance
---

# Expand AuditLoggingService

## What
Enhance the auditing system to capture security-significant events as required by NIST AU-2.

## Detailed Requirements
- Log access to secrets (retrieving API keys).
- Log all validation failures (invalid audio, size exceeded).
- Log configuration changes and permission modifications.
- Ensure logs include user identity, timestamp, and event type.
- Linked Bead: ScottWisper-mf0p

## Implementation Details
- **Secret Access**: Integrated `IAuditLoggingService` into `SettingsService.cs` to log every retrieval of encrypted values. `WindowsCredentialService` already logs key retrievals from the system credential manager.
- **Validation Failures**: Verified that `AudioValidationProvider.cs` logs all audio validation failures as `SecurityEvent` with detailed error messages.
- **Configuration Changes**: Added logging to `SettingsService.SetValueAsync` and `RestoreSettingsAsync` to record all configuration modifications.
- **Permission Modifications**: Verified that `PermissionService.cs` logs microphone permission checks and request results.
- **Log Structure**: Confirmed that `AuditLogEntry` (in `AuditLog.cs`) automatically captures `Id`, `Timestamp`, `EventType`, and `UserId` (hashed).
- Verified compatibility by running existing and new unit tests.

## Full Context
See [user-requests/UR-002/input.md](./user-requests/UR-002/input.md) for complete verbatim input.
