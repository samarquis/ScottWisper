<?xml version="1.0" encoding="UTF-8"?>
<!--
  WhisperKey MSI Installer - WiX v4
  
  Build Commands:
    1. Harvest files: wix harvest dir ./publish -o ./Installer/Files.wxs -cg ProductComponents -gg
    2. Build MSI: wix build ./Installer/WhisperKey.wxs ./Installer/Files.wxs -o ./WhisperKey.msi -d Version=$(Version)
  
  Silent Install:
    msiexec /i WhisperKey.msi /qn
    
  Uninstall:
    msiexec /x WhisperKey.msi /qn
-->
<Wix xmlns="http://wixtoolset.org/schemas/v4/wxs">
  
  <!-- Version is passed as preprocessor variable from build script -->
  <?ifndef Version ?>
    <?define Version = "1.0.0" ?>
  <?endif?>
     
  <Package Name="WhisperKey" 
           Language="1033" 
           Version="$(var.Version)" 
           Manufacturer="WhisperKey" 
           UpgradeCode="a3ef09de-38b1-4068-87c0-9a7d707d1a88">
    
    <MajorUpgrade DowngradeErrorMessage="A newer version of WhisperKey is already installed." />
    
    <MediaTemplate EmbedCab="yes" />
    
    <!-- Features -->
    <Feature Id="ProductFeature" Title="WhisperKey" Level="1">
      <ComponentGroupRef Id="ProductComponents" />
      <ComponentRef Id="ApplicationShortcuts" />
      <ComponentRef Id="RegistryEntries" />
    </Feature>
    
    <!-- Standard Install Location -->
    <StandardDirectory Id="ProgramFiles6432Folder">
      <Directory Id="INSTALLFOLDER" Name="WhisperKey" />
    </StandardDirectory>
    
    <!-- Start Menu -->
    <StandardDirectory Id="ProgramMenuFolder">
      <Directory Id="ApplicationProgramsFolder" Name="WhisperKey" />
    </StandardDirectory>
    
    <!-- Desktop -->
    <StandardDirectory Id="DesktopFolder" />
    
    <!-- Application Shortcuts -->
    <DirectoryRef Id="ApplicationProgramsFolder">
      <Component Id="ApplicationShortcuts" Guid="*">
        <Shortcut Id="StartMenuShortcut"
                  Directory="ApplicationProgramsFolder"
                  Name="WhisperKey"
                  Description="Voice-to-Text Dictation Software"
                  Target="[INSTALLFOLDER]WhisperKey.exe"
                  WorkingDirectory="INSTALLFOLDER"
                   />
        <RemoveFolder Id="ApplicationProgramsFolder" On="uninstall" />
        <RegistryValue Root="HKCU" 
                      Key="Software\WhisperKey" 
                      Name="Installed" 
                      Type="integer" 
                      Value="1" 
                      KeyPath="yes" />
      </Component>
    </DirectoryRef>
    
    <!-- Desktop Shortcut (optional, controlled by DESKTOPSHORTCUT property) -->
    <StandardDirectory Id="DesktopFolder">
      <Component Id="DesktopShortcutComp" Guid="*" Condition="DESKTOPSHORTCUT">
        <Shortcut Id="DesktopShortcut"
                  Directory="DesktopFolder"
                  Name="WhisperKey"
                  Target="[INSTALLFOLDER]WhisperKey.exe"
                  WorkingDirectory="INSTALLFOLDER" />
        <RegistryValue Root="HKCU" 
                      Key="Software\WhisperKey" 
                      Name="DesktopShortcut" 
                      Type="integer" 
                      Value="1" 
                      KeyPath="yes" />
      </Component>
    </StandardDirectory>
    
    <!-- Registry Entries -->
    <Component Id="RegistryEntries" Guid="*" Directory="INSTALLFOLDER">
      <RegistryKey Root="HKLM" Key="Software\WhisperKey">
        <RegistryValue Type="string" Name="InstallPath" Value="[INSTALLFOLDER]" />
        <RegistryValue Type="string" Name="Version" Value="$(var.Version)" />
      </RegistryKey>
    </Component>
    
    <!-- Properties -->
    <Property Id="DESKTOPSHORTCUT" Value="0" />
    
  </Package>
</Wix>
