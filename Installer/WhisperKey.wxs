<?xml version="1.0" encoding="UTF-8"?>
<!--
  WhisperKey MSI Installer - WiX v4
  
  Build Commands:
    1. Harvest files: wix harvest dir ./publish -o ./Installer/Files.wxs -cg ProductComponents -gg
    2. Build MSI: wix build ./Installer/WhisperKey.wxs ./Installer/Files.wxs -ext WixToolset.UI.wixext -o ./WhisperKey.msi -d Version=$(Version)
  
  Silent Install:
    msiexec /i WhisperKey.msi /qn
    
  Uninstall:
    msiexec /x WhisperKey.msi /qn
-->
<Wix xmlns="http://wixtoolset.org/schemas/v4/wxs"
     xmlns:ui="http://wixtoolset.org/schemas/v4/wxs/ui">
  
  <!-- Version is passed as preprocessor variable from build script -->
  <?ifndef Version ?>
    <?define Version = "1.0.0" ?>
  <?endif?>
     
  <Package Name="WhisperKey" 
           Language="1033" 
           Version="$(var.Version)" 
           Manufacturer="WhisperKey" 
           UpgradeCode="a3ef09de-38b1-4068-87c0-9a7d707d1a88"
           Scope="perMachine">
    
    <MajorUpgrade DowngradeErrorMessage="A newer version of WhisperKey is already installed." />
    
    <MediaTemplate EmbedCab="yes" />
    
    <!-- Icons -->
    <Icon Id="ProductIcon.ico" SourceFile="Resources\WhisperKey.ico" />
    <Property Id="ARPPRODUCTICON" Value="ProductIcon.ico" />

    <!-- UI -->
    <ui:WixUI Id="WixUI_InstallDir" InstallDirectory="INSTALLFOLDER" />
    
    <!-- Features -->
    <Feature Id="ProductFeature" Title="WhisperKey" Level="1">
      <ComponentGroupRef Id="ProductComponents" />
      <ComponentRef Id="ApplicationShortcut" />
    </Feature>
    
    <!-- Shortcuts -->
    <StandardDirectory Id="ProgramMenuFolder">
      <Directory Id="ApplicationProgramsFolder" Name="WhisperKey">
        <Component Id="ApplicationShortcut" Guid="892f3e8b-8772-4d92-95f7-4f8101664654">
          <Shortcut Id="ApplicationStartMenuShortcut" 
                    Name="WhisperKey" 
                    Description="Voice-to-Text Dictation Software"
                    Target="[INSTALLFOLDER]WhisperKey.exe"
                    WorkingDirectory="INSTALLFOLDER"
                    Icon="ProductIcon.ico" />
          <RemoveFolder Id="CleanUpShortCut" On="uninstall" />
          <RegistryValue Root="HKCU" Key="Software\WhisperKey" Name="installed" Type="integer" Value="1" KeyPath="yes" />
        </Component>
      </Directory>
    </StandardDirectory>
    
    <!-- Desktop Shortcut Property -->
    <Property Id="DESKTOPSHORTCUT" Value="0" />
    
  </Package>
</Wix>