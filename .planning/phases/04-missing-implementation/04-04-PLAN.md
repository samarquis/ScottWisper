---
phase: 04-missing-implementation
plan: 04
type: execute
wave: 3
depends_on: [04-01, 04-02, 04-03]
files_modified: [src/Validation/Phase04Validator.cs, src/Integration/GapClosureTestRunner.cs]
autonomous: true
must_haves:
  truths:
    - "All Phase 04 requirements (CORE-03, SYS-02, SYS-03) are validated complete"
    - "Gap closure validation shows 95%+ success rate across all tested scenarios"
    - "User workflows work end-to-end without blocking issues"
  artifacts:
    - path: "src/Validation/Phase04Validator.cs"
      provides: "Comprehensive Phase 04 validation"
      min_lines: 150
    - path: "src/Integration/GapClosureTestRunner.cs"
      provides: "Gap closure test orchestration"
      contains: "RunPhase04ValidationAsync"
  key_links:
    - from: "src/Validation/Phase04Validator.cs"
      to: "src/Validation/CrossApplicationValidator.cs"
      via: "composition"
      pattern: "CrossApplicationValidator"
    - from: "src/Validation/Phase04Validator.cs"
      to: "src/Services/AudioDeviceService.cs"
      via: "dependency injection"
      pattern: "IAudioDeviceService"
    - from: "src/Validation/Phase04Validator.cs"
      to: "src/Services/SettingsService.cs"
      via: "dependency injection"
      pattern: "ISettingsService"
---

<objective>
Execute comprehensive Phase 04 validation to confirm all gap closure requirements are complete and working.

Purpose: Validate that CORE-03, SYS-02, and SYS-03 requirements are fully implemented with 95%+ success rate.
Output: Complete validation report showing all requirements satisfied and ready for Phase 05.
</objective>

<execution_context>
@~/.config/opencode/get-shit-done/workflows/execute-plan.md
@~/.config/opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/04-missing-implementation/04-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Create Phase04Validator</name>
  <files>src/Validation/Phase04Validator.cs</files>
  <action>
Create Phase04Validator with comprehensive test coverage:
- Constructor injection of CrossApplicationValidator, IAudioDeviceService, ISettingsService, IPermissionService
- ValidateCore03_TextInjectionAsync method using CrossApplicationValidator results
- ValidateSys02_SettingsManagementAsync method testing settings UI completeness
- ValidateSys03_AudioDeviceSelectionAsync method testing device switching and permissions
- RunCompleteValidationAsync method orchestrating all validation tests
- GeneratePhase04ReportAsync method creating detailed validation report
- Include edge case testing (permission denied, no audio devices, etc.)
- Performance validation for all operations (latency, resource usage)
- Integration testing between all three requirement areas
- Error scenario testing and recovery validation
  </action>
  <verify>
dotnet build --no-restore succeeds
</verify>
  <done>Phase04Validator created with comprehensive test coverage</done>
</task>

<task type="auto">
  <name>Create GapClosureTestRunner</name>
  <files>src/Integration/GapClosureTestRunner.cs</files>
  <action>
Create GapClosureTestRunner for systematic validation:
- Orchestrate Phase04Validator test execution
- Execute validation in structured sequence (CORE-03 → SYS-02 → SYS-03)
- Collect and aggregate results from all validation tests
- Generate comprehensive Phase04ValidationReport.md
- Include pass/fail status, success rates, and detailed metrics
- Test real-world user workflows (dictation → settings change → device switch)
- Validate cross-component interactions and edge cases
- Include performance benchmarks and resource usage analysis
- Provide recommendations for any identified issues
- Support both automated and manual validation modes
  </action>
  <verify>
dotnet build --no-restore succeeds
</verify>
  <done>GapClosureTestRunner created with systematic validation orchestration</done>
</task>

<task type="checkpoint:human-verify">
  <what-built>Complete Phase 04 validation framework and comprehensive test results</what-built>
  <how-to-verify>
1. Run the validation tests using GapClosureTestRunner
2. Review the generated Phase04ValidationReport.md
3. Verify that all three requirements show 95%+ success rate
4. Test key user workflows manually:
   - Open settings, change hotkey, verify it works
   - Switch audio device, verify recording works
   - Test dictation in different applications
5. Confirm no blocking issues prevent normal application usage
  </how-to-verify>
  <resume-signal>Type "approved" if validation passes 95% success criteria, or describe issues to address</resume-signal>
</task>

</tasks>

<verification>
- Phase04Validator successfully validates all three requirements
- GapClosureTestRunner generates comprehensive validation report
- CORE-03 validation shows text injection works across target applications
- SYS-02 validation confirms settings UI completeness and persistence
- SYS-03 validation verifies device switching and permission handling
- Overall validation success rate meets or exceeds 95% threshold
- User workflows tested end-to-end without blocking issues
- Performance metrics meet application requirements
</verification>

<success_criteria>
- All Phase 04 requirements validated complete with 95%+ success rate
- CORE-03 text injection validated across all target applications
- SYS-02 settings management validated with complete UI and persistence
- SYS-03 audio device selection validated with reliable switching and permissions
- Comprehensive validation report generated showing all metrics
- No blocking issues identified that would prevent Phase 05 progress
- Phase 04 ready for closure and Phase 05 initiation
</success_criteria>

<output>
After completion, create `.planning/phases/04-missing-implementation/04-04-SUMMARY.md`
Generate comprehensive `Phase04ValidationReport.md` documenting all validation results
</output>