---
phase: 03-integration-layer-repair
plan: 02
type: execute
wave: 1
depends_on: []
files_modified: [SettingsWindow.xaml.cs, SettingsWindow.xaml, Services/SettingsService.cs, IntegrationTestFramework.cs]
autonomous: false
gap_closure: true

must_haves:
  truths:
    - "Complete settings UI for hotkey configuration with visual recording interface"
    - "Audio device selection interface with real-time device testing"
    - "API settings configuration interface with validation and error handling"
    - "Systematic integration testing framework across target applications"
  artifacts:
    - path: "SettingsWindow.xaml.cs"
      provides: "Complete settings UI implementation for all configuration areas"
      min_lines: 400
    - path: "SettingsWindow.xaml"
      provides: "Professional settings interface with tabbed layout"
      min_lines: 100
    - path: "IntegrationTestFramework.cs"
      provides: "Automated testing framework for cross-application validation"
      min_lines: 300
  key_links:
    - from: "SettingsWindow.xaml.cs"
      to: "Services/SettingsService.cs"
      via: "Settings binding and validation"
      pattern: "HotkeyConfiguration|AudioDeviceSelection|APISettings"
    - from: "IntegrationTestFramework.cs"
      to: "TextInjectionService.cs"
      via: "Cross-application testing automation"
      pattern: "TestCrossApplicationInjection|ValidateCompatibility"
---

<objective>
Complete the Settings UI implementation and create systematic integration testing framework to close gaps identified in Phase 02 verification.

Purpose: Provide users with complete configuration interface for hotkey, audio device, and API settings, plus automated testing framework to validate cross-application compatibility.
Output: Professional settings interface with full functionality and comprehensive integration testing framework for validation.
</objective>

<execution_context>
@~/.config/opencode/get-shit-done/workflows/execute-plan.md
@~/.config/opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-windows-integration/02-windows-integration-VERIFICATION.md
@.planning/phases/02-windows-integration/02-21-SUMMARY.md

# Gap Source: Phase 02 Verification Gaps
Gap 3: Settings UI Completeness - SettingsService backend complete but SettingsWindow.xaml.cs UI incomplete
Gap 4: Integration Testing Framework - No systematic testing across target applications
</context>

<tasks>

<task type="auto">
  <name>Task 1: Complete SettingsWindow.xaml.cs with full configuration interface</name>
  <files>SettingsWindow.xaml.cs, SettingsWindow.xaml</files>
  <action>
    Reference existing SettingsWindow.xaml.cs and SettingsService.cs (774 lines) and complete:
    
    1. Hotkey Configuration UI:
       - Implement HotkeyRecordingTextBox with visual feedback
       - Add RecordHotkeyButton with start/stop recording states
       - Create HotkeyConflictDetector with real-time validation
       - Add HotkeyTestButton to verify hotkey functionality
       - Implement HotkeyProfileManager for multiple profiles
       - Add Import/ExportHotkeyProfiles functionality
    
    2. Audio Device Selection Interface:
       - Create AudioDeviceComboBox with real-time device enumeration
       - Add TestDeviceButton with audio level visualization
       - Implement DeviceCompatibilityIndicator for each device
       - Add DefaultDeviceToggle for system integration
       - Create DeviceChangeNotifier for real-time updates
       - Add AudioQualityMeter for device testing
    
    3. API Settings Configuration:
       - Implement APIEndpointTextBox with validation
       - Add APIKeyTextBox with secure password display
       - Create ConnectionTestButton with status feedback
       - Add UsageLimitDisplay with real-time tracking
       - Implement ModelSelectionComboBox for Whisper variants
       - Add RequestTimeoutSlider with value display
    
    4. Settings Validation and Error Handling:
       - Add comprehensive input validation for all settings
       - Implement SettingsErrorProvider with user-friendly messages
       - Create SettingsBackupManager with auto-restore
       - Add SettingsResetButton with confirmation dialog
       - Implement SettingsChangeNotifier for real-time updates
    
    Gap reason: "Complete hotkey configuration UI implementation", "Audio device selection interface", "API settings configuration interface"
  </action>
  <verify>
    1. Build solution with enhanced SettingsWindow
    2. Verify all UI controls compile and render correctly
    3. Check settings binding to SettingsService works properly
    4. Validate input validation and error handling functionality
  </verify>
  <done>SettingsWindow.xaml.cs enhanced with 300+ additional lines for complete configuration interface, supporting hotkey recording, device selection, and API settings with full validation</done>
</task>

<task type="auto">
  <name>Task 2: Create comprehensive IntegrationTestFramework for cross-application validation</name>
  <files>IntegrationTestFramework.cs, CrossApplicationTests.cs</files>
  <action>
    Create systematic testing framework to validate cross-application compatibility:
    
    1. Test Framework Infrastructure:
       - Create IntegrationTestFramework base class with test orchestration
       - Implement ApplicationLauncher for automated app testing
       - Add TestResultCollector with detailed reporting
       - Create TestEnvironmentManager for setup/teardown
       - Implement TestDataProvider with test text and scenarios
    
    2. Browser Compatibility Testing:
       - Create BrowserTestSuite for Chrome, Firefox, Edge
       - Implement AutomatedBrowserNavigation to test pages
       - Add TextFieldDetection for various input types
       - Create BrowserInjectionValidator with accuracy metrics
       - Implement BrowserSpecificWorkarounds for each browser
    
    3. IDE and Editor Testing:
       - Create IDETestSuite for Visual Studio integration
       - Implement CodeEditorDetection for different file types
       - Add SyntaxAwareInjection for code contexts
       - Create EditorPositionValidator for cursor accuracy
       - Implement ProjectStructureNavigation for complex scenarios
    
    4. Office and Productivity Testing:
       - Create OfficeTestSuite for Word, Outlook, Excel
       - Implement DocumentTypeDetection for various formats
       - Add FormattingPreservationValidator for rich text
       - Create OfficeApplicationAutomation for UI testing
       - Implement TemplateCompatibilityTesting for standard forms
    
    5. Terminal and Command Line Testing:
       - Create TerminalTestSuite for Windows Terminal, CMD, PowerShell
       - Implement ShellDetection for different command environments
       - Add CommandLineContextValidator for prompt accuracy
       - Create TerminalAutomation for command history testing
       - Implement PathCompletionTesting for complex scenarios
    
    Gap reason: "Integration testing framework for target applications", "Application-specific compatibility testing", "Fallback mechanisms for permission-restricted applications"
  </action>
  <verify>
    1. Build solution with IntegrationTestFramework
    2. Verify all test suites compile and can be instantiated
    3. Check test result collection and reporting functionality
    4. Validate automated application launching capabilities
  </verify>
  <done>IntegrationTestFramework created with 400+ lines of comprehensive testing infrastructure, supporting automated cross-application compatibility validation across all target applications</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Complete Settings UI implementation and comprehensive IntegrationTestFramework for cross-application validation</what-built>
  <how-to-verify>
    1. Settings UI Completeness Testing:
       - Open WhisperKey settings window
       - Test hotkey recording: Click record button, press desired hotkey, verify visual feedback
       - Test audio device selection: Select different devices, click test button, verify audio level display
       - Test API settings: Enter configuration, click connection test, verify status feedback
       - Test settings validation: Enter invalid values, verify error messages and corrections
       
    2. Integration Testing Framework Validation:
       - Run IntegrationTestFramework automated tests
       - Verify browser compatibility tests execute for Chrome, Firefox, Edge
       - Check IDE testing works with Visual Studio automation
       - Confirm Office application testing can launch and test Word/Outlook
       - Validate terminal testing works with Windows Terminal and CMD
       
    3. End-to-End Settings Workflow:
       - Configure hotkey, save settings, restart application
       - Verify hotkey persists and works correctly
       - Change audio device, test recording with new device
       - Modify API settings, test transcription with new configuration
       
    Expected results from verification:
    - Settings UI provides complete configuration for all areas
    - Hotkey recording works with visual feedback and conflict detection
    - Audio device selection shows real-time testing and compatibility
    - API settings validate properly and test connectivity
    - Integration tests can automatically validate cross-application compatibility
    - All settings persist correctly through application restarts
  </how-to-verify>
  <resume-signal>Type "approved" if settings UI is complete and integration testing framework works, or describe specific issues encountered</resume-signal>
</task>

</tasks>

<verification>
- Build succeeds with complete settings UI and testing framework
- All configuration areas functional with proper validation
- Integration tests can execute across target applications
- Settings persistence and hotkey recording work correctly
- Audio device testing and API configuration validation operational
</verification>

<success_criteria>
Complete settings interface with hotkey recording, audio device selection, and API configuration, plus automated integration testing framework capable of validating cross-application text injection compatibility across all target applications.
</success_criteria>

<output>
After completion, create `.planning/phases/03-integration-layer-repair/03-02-SUMMARY.md`
</output>