---
phase: 02-windows-integration
plan: 01
type: execute
wave: 1
depends_on: ["01-core-technology-validation"]
files_modified: [ScottWisper.csproj, TextInjectionService.cs]
autonomous: true
must_haves:
  truths:
    - "Required NuGet packages for input injection are installed"
    - "TextInjectionService provides universal text injection methods"
    - "Input injection APIs are properly initialized and cleaned up"
    - "Fallback mechanisms handle permission-restricted applications"
  artifacts:
    - path: "TextInjectionService.cs"
      provides: "Universal text injection using Windows Input APIs"
      contains: "InputInjection"
      min_lines: 100
    - path: "ScottWisper.csproj"
      provides: "Required NuGet packages for input injection"
      contains: "H.InputSimulator"
  key_links:
    - from: "ScottWisper.csproj"
      to: "TextInjectionService.cs"
      via: "package dependency"
      pattern: "H.InputSimulator"
---

<objective>
Establish the foundation for universal text injection capability with core service implementation and Windows Input APIs integration.

Purpose: Create the essential text injection infrastructure that enables placing transcribed text at exact cursor positions across Windows applications.
Output: TextInjectionService with multiple injection methods and proper package configuration.
</objective>

<execution_context>
@~/.config/opencode/get-shit-done/workflows/execute-plan.md
@~/.config/opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/02-windows-integration/02-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Add required NuGet packages for input injection</name>
  <files>ScottWisper.csproj</files>
  <action>
Add input injection NuGet packages to the project:
1. Add H.InputSimulator package for keyboard simulation fallback
2. Add Microsoft.Windows.SDK.Contracts for Windows 10/11 APIs
3. Ensure proper versioning for .NET 8 compatibility
4. Update package references in ScottWisper.csproj
5. Restore packages and verify no conflicts

Package details:
- H.InputSimulator v1.4.0+ for SendInput wrapper
- Microsoft.Windows.SDK.Contracts for WinRT interop
- Target Windows 10 version 19041+ for Input.Preview.Injection APIs
</action>
  <verify>dotnet restore succeeds and packages are properly referenced</verify>
  <done>Required input injection packages are installed and configured</done>
</task>

<task type="auto">
  <name>Create TextInjectionService with Windows Input APIs</name>
  <files>TextInjectionService.cs</files>
  <action>
Implement TextInjectionService.cs with multiple injection methods:
1. Create service class implementing ITextInjection interface
2. Implement Windows UI Input.Preview.Injection API as primary method
3. Add H.InputSimulator as fallback mechanism
4. Add clipboard-based fallback for restricted applications
5. Add proper initialization and cleanup with IDisposable pattern
6. Include cursor position detection and window focus verification
7. Add error handling and retry logic for failed injections

Key features:
- Thread-safe text injection
- Unicode character support
- Special character handling (newlines, tabs)
- Application-specific compatibility modes
- Performance optimization for long text segments
</action>
  <verify>TextInjectionService compiles and all injection methods are implemented</verify>
  <done>TextInjectionService provides multiple reliable text injection mechanisms</done>
</task>

</tasks>

<verification>
1. H.InputSimulator package is properly installed and referenced
2. Microsoft.Windows.SDK.Contracts package is properly configured
3. TextInjectionService compiles without errors and implements all required methods
4. Text injection works with Windows Input.Preview.Injection API
5. Fallback mechanisms (H.InputSimulator, clipboard) are implemented
6. Service properly initializes and cleans up resources
7. Unicode text and special characters are handled correctly
8. Thread-safe operation is implemented
</verification>

<success_criteria>
- TextInjectionService provides universal text injection foundation
- Multiple injection methods handle different application scenarios
- Package dependencies are properly configured and compatible
- Service is ready for integration with transcription workflow
- Unicode and special character support is implemented
- Resource management follows best practices with IDisposable
</success_criteria>

<output>
After completion, create `.planning/phases/02-windows-integration/02-01-SUMMARY.md`
</output>