---
phase: 01-core-technology-validation
plan: 03
type: execute
wave: 2
depends_on: ["01-02"]
files_modified: [TranscriptionWindow.xaml, TranscriptionWindow.xaml.cs, CostTrackingService.cs, App.xaml.cs]
autonomous: false
must_haves:
  truths:
    - "Transcribed text appears in real-time as user speaks"
    - "Text display updates within 100ms of API response"
    - "Cost tracking accurately monitors API usage against free tier limits"
  artifacts:
    - path: "TranscriptionWindow.xaml"
      provides: "Real-time text display interface"
      contains: "TextBlock"
    - path: "TranscriptionWindow.xaml.cs"
      provides: "Text update logic and window management"
      min_lines: 30
    - path: "CostTrackingService.cs"
      provides: "API usage monitoring and cost calculation"
      contains: "CostTracking"
      exports: ["TrackUsage", "GetUsageStats"]
  key_links:
    - from: "TranscriptionWindow.xaml.cs"
      to: "WhisperService.cs"
      via: "transcription result subscription"
      pattern: "TranscriptionCompleted"
    - from: "CostTrackingService.cs"
      to: "WhisperService.cs"
      via: "usage tracking integration"
      pattern: "TrackUsage"
---

<objective>
Create real-time text display interface and implement cost tracking for sustainable free tier usage.

Purpose: Provide users with immediate visual feedback of their transcribed speech while monitoring API usage to ensure the service remains within free tier limits for sustainable operation.
Output: Real-time transcription display window with cost tracking and usage monitoring capabilities.
</objective>

<execution_context>
@~/.config/opencode/get-shit-done/workflows/execute-plan.md
@~/.config/opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-core-technology-validation/01-02-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Create real-time transcription display window</name>
  <files>TranscriptionWindow.xaml, TranscriptionWindow.xaml.cs</files>
  <action>
Create TranscriptionWindow for real-time text display:
1. Design TranscriptionWindow.xaml with clean, minimal UI:
   - Large text area for displaying transcribed text
   - Status indicator (recording/processing/ready)
   - Close button and basic window controls
   - Semi-transparent background for overlay capability
2. Implement TranscriptionWindow.xaml.cs with:
   - Real-time text updates from WhisperService results
   - Smooth text appending and scrolling
   - Window positioning logic (near cursor or screen center)
   - Auto-hide functionality after inactivity
   - Event handling for transcription service updates
3. Add text formatting and readability features:
   - Font size optimization for dictation reading
   - Text wrapping and proper line breaks
   - Clear visual feedback for recording status
4. Implement window management:
   - Show/hide on hotkey activation
   - Always-on-top option for active dictation
   - Proper cleanup and resource management

UI requirements:
- Window size: 600x400 pixels (adjustable)
- Background: Semi-transparent white (90% opacity)
- Text: Clear sans-serif font, 14pt size
- Status indicator: Colored dot (red=recording, yellow=processing, green=ready)
</action>
  <verify>TranscriptionWindow displays text updates smoothly and responsively</verify>
  <done>Real-time transcription display window shows text as it's generated</done>
</task>

<task type="auto">
  <name>Implement cost tracking service for API usage monitoring</name>
  <files>CostTrackingService.cs</files>
  <action>
Create CostTrackingService.cs for monitoring OpenAI API usage:
1. Implement usage tracking functionality:
   - Track number of API calls made
   - Calculate audio duration processed
   - Estimate costs based on OpenAI Whisper pricing
   - Store usage data in local settings file
2. Add free tier monitoring:
   - Set free tier limits (e.g., $5/month credit)
   - Calculate remaining free tier usage
   - Warn when approaching limits
   - Block usage if limits exceeded (configurable)
3. Create usage statistics and reporting:
   - Daily/weekly/monthly usage summaries
   - Cost breakdown by time period
   - Usage trends and projections
   - Export usage data for analysis
4. Implement persistence and data management:
   - Save usage data to local JSON file
   - Load previous usage on startup
   - Handle data corruption and recovery
   - Provide reset functionality for usage data

Cost calculation logic:
- Whisper API: $0.006 per minute (as of current pricing)
- Track audio duration in seconds
- Calculate cost: duration_seconds / 60 * 0.006
- Free tier: $5.00 monthly credit
- Warning threshold: 80% of free tier used
</action>
  <verify>Cost tracking accurately monitors API usage and calculates costs</verify>
  <done>Cost tracking service provides accurate usage statistics and free tier monitoring</done>
</task>

<task type="auto">
  <name>Integrate transcription display and cost tracking with main application</name>
  <files>App.xaml.cs, TranscriptionWindow.xaml.cs</files>
  <action>
Connect transcription and cost tracking services to main application:
1. Update App.xaml.cs to:
   - Initialize TranscriptionWindow on hotkey activation
   - Wire WhisperService results to TranscriptionWindow updates
   - Start CostTrackingService on application startup
   - Handle transcription lifecycle events
2. Implement service coordination:
   - Start audio capture when hotkey pressed
   - Stream audio to WhisperService for transcription
   - Update TranscriptionWindow with results in real-time
   - Track API usage through CostTrackingService
   - Stop capture and hide window when dictation ends
3. Add error handling and recovery:
   - Handle transcription service failures gracefully
   - Show user-friendly error messages
   - Retry failed API calls automatically
   - Maintain application stability during errors
4. Optimize performance:
   - Minimize UI update latency
   - Efficient memory management for audio buffers
   - Proper disposal of resources when not in use
   - Background processing for API calls

Integration requirements:
- Sub-100ms latency from API response to UI update
- Seamless service communication without blocking UI
- Proper cleanup of resources on application exit
- Error recovery without user intervention
</action>
  <verify>End-to-end integration works with real-time text display and cost tracking</verify>
  <done>Complete integration provides working dictation with usage monitoring</done>
</task>

</tasks>

<verification>
1. TranscriptionWindow appears when hotkey is pressed
2. Transcribed text displays in real-time as user speaks
3. Text updates occur within 100ms of API response
4. Cost tracking accurately records API usage
5. Free tier warnings appear when approaching limits
6. Application remains stable during continuous dictation
7. Resources are properly cleaned up when dictation ends
</verification>

<success_criteria>
- Real-time transcription display works smoothly and responsively
- Text appears within 100ms of speech-to-text conversion
- Cost tracking accurately monitors API usage against free tier limits
- User receives clear feedback about transcription status and usage
- Integration between services is seamless and error-free
- Application performance meets latency requirements
</success_criteria>

<output>
After completion, create `.planning/phases/01-core-technology-validation/01-03-SUMMARY.md`
</output>