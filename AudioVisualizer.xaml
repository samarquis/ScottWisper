<UserControl x:Class="WhisperKey.AudioVisualizer"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
             mc:Ignorable="d" 
             d:DesignHeight="120" d:DesignWidth="400"
             Background="Transparent">
    
    <UserControl.Resources>
        <!-- Color resources for audio levels -->
        <Color x:Key="LevelLowColor">#4CAF50</Color>
        <Color x:Key="LevelMediumColor">#FFC107</Color>
        <Color x:Key="LevelHighColor">#F44336</Color>
        
        <!-- Brushes for gradient effects -->
        <LinearGradientBrush x:Key="WaveformBrush" StartPoint="0,0" EndPoint="0,1">
            <GradientStop Color="#2196F3" Offset="0"/>
            <GradientStop Color="#1976D2" Offset="1"/>
        </LinearGradientBrush>
        
        <LinearGradientBrush x:Key="PeakLevelBrush" StartPoint="0,0" EndPoint="1,0">
            <GradientStop Color="Transparent" Offset="0"/>
            <GradientStop Color="#4CAF50" Offset="0.5"/>
            <GradientStop Color="Transparent" Offset="1"/>
        </LinearGradientBrush>
    </UserControl.Resources>
    
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>
        
        <!-- Header with visualization mode selector -->
        <Border Grid.Row="0" Background="#1E1E1E" Padding="8,4" CornerRadius="4,4,0,0">
            <StackPanel Orientation="Horizontal" HorizontalAlignment="Left">
                <TextBlock Text="Visualization:" Foreground="#CCCCCC" FontSize="10" VerticalAlignment="Center"/>
                <ComboBox x:Name="VisualizationModeCombo" 
                         Width="80" 
                         Margin="4,0" 
                         FontSize="10"
                         SelectionChanged="VisualizationModeCombo_SelectionChanged">
                    <ComboBoxItem Content="Waveform" IsSelected="True"/>
                    <ComboBoxItem Content="Bars"/>
                    <ComboBoxItem Content="Minimal"/>
                </ComboBox>
            </StackPanel>
        </Border>
        
        <!-- Main visualization area -->
        <Border Grid.Row="1" Background="#2D2D30" Padding="4">
            <Canvas x:Name="WaveformCanvas" 
                    ClipToBounds="True"
                    Width="392" 
                    Height="80">
                
                <!-- Waveform visualization -->
                <Polyline x:Name="WaveformPolyline"
                         Stroke="{StaticResource WaveformBrush}"
                         StrokeThickness="2"
                         StrokeLineJoin="Round"
                         StrokeStartLineCap="Round"
                         StrokeEndLineCap="Round"
                         Points="0,40 392,40"/>
                
                <!-- Peak level indicator -->
                <Rectangle x:Name="PeakLevelIndicator"
                          Fill="{StaticResource PeakLevelBrush}"
                          Width="4"
                          Height="2"
                          Canvas.Left="196"
                          Canvas.Top="39"
                          Opacity="0.8"/>
                
                <!-- Voice activity indicator -->
                <Ellipse x:Name="VoiceActivityIndicator"
                          Fill="#4CAF50"
                          Width="8"
                          Height="8"
                          Canvas.Left="8"
                          Canvas.Top="8"
                          Opacity="0.3"/>
            </Canvas>
        </Border>
        
        <!-- Footer with level meters -->
        <Border Grid.Row="2" Background="#1E1E1E" Padding="8,4" CornerRadius="0,0,4,4">
            <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                <!-- Audio level meter -->
                <Border Background="#3E3E42" Width="300" Height="8" CornerRadius="4">
                    <Grid>
                        <Rectangle x:Name="AudioLevelBackground" 
                                  Fill="#3E3E42" 
                                  Width="300" 
                                  Height="8" 
                                  RadiusX="4" 
                                  RadiusY="4"/>
                        <Rectangle x:Name="AudioLevelBar" 
                                  Fill="#4CAF50" 
                                  Width="0" 
                                  Height="8" 
                                  RadiusX="4" 
                                  RadiusY="4"
                                  HorizontalAlignment="Left"/>
                    </Grid>
                </Border>
                
                <!-- Peak level text -->
                <TextBlock x:Name="PeakLevelText"
                          Text="0 dB"
                          Foreground="#CCCCCC"
                          FontSize="10"
                          Margin="8,0"
                          VerticalAlignment="Center"/>
            </StackPanel>
        </Border>
    </Grid>
</UserControl>